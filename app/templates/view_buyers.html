{% import "toolkit/summary-table.html" as summary %}

{% extends "_base_page.html" %}

{% block page_title %}
    Buyers – Digital Marketplace admin
{% endblock %}

{% block breadcrumb %}
  {%
      with items = [
          {
              "link": url_for('.index'),
              "label": "Admin home"
          },
      ]
  %}
    {% include "_breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block main_content %}
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
      {% for category, message in messages %}
          {% if message == 'no_brief' %}
              {% set displayed_message = "There are no opportunities with ID {}".format(brief_id) %}
          {% elif message == 'brief_updated' %}
{% set displayed_message = "Brief updated ID {}".format(brief_id) %}
{% else %}
{% set displayed_message = message %}
{% endif %}
          {%
          with
              message = displayed_message,
              type = "destructive" if category == 'error' else "success"
          %}
<div class={{ "callout--warning" if category == 'error' else "callout" }}>
          {% include "toolkit/notification-banner.html" %}
</div>
          {% endwith %}
      {% endfor %}
  {% endif %}
  {% endwith %}

  {% with heading = brief_id|string + ' - ' + title if title %}
  {% include "toolkit/page-heading.html" %}
  {% endwith %}

  {% call(item) summary.list_table(
          users,
          caption="Buyers",
          empty_message="No buyers to show",
          field_headings=[
              'Name',
              'Email',
              'Phone number'
          ],
          field_headings_visible=True)
      %}

      {% call summary.row() %}

        {{ summary.field_name(item.name) }}

        {% call summary.field() %}
          {{ item.emailAddress }}
        {% endcall %}

        {% call summary.field() %}
          {{ item.phoneNumber }}
        {% endcall %}


      {% endcall %}

  {% endcall %}

  <br>
{% if brief %}
<form action="{{ url_for('.update_brief',brief_id=brief_id) }}" method="post" class="question">

    <label class="question-heading" for="questions_closed_at">Set new question date (YYYY-MM-DD)</label>
    <input type="text" name="questions_closed_at" id="questions_closed_at" class="text-box"  value="{{brief.dates.questions_closing_date}}">

    <label class="question-heading" for="closed_at">Set new closing date (YYYY-MM-DD)</label>
    <input type="text" name="closed_at" id="closed_at" class="text-box" value="{{brief.dates.closing_date}}">

    <input type="submit" value="Save" class="button-save">
</form>
{% endif %}
  <form action="{{ url_for('.find_buyer_by_brief_id') }}" method="get" class="question">
      <label class="question-heading" for="brief_id">Find buyer by opportunity ID</label>
      <p class='hint'>
        You can find this number at the end of the opportunities’ URL.
      </p>
      <input type="text" name="brief_id" id="brief_id" class="text-box">
      <input type="submit" value="Search" class="button-save">
  </form>
  </div>

{% endblock %}
